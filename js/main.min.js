Highcharts.setOptions({global:{useUTC:!1}});var makeTempGauges=function(a){makeTempGuage("#temperature_g",""!==a.temperature?parseFloat(a.temperature):0,"Temperature",32,120,"°"),makeTempGuage("#humidity_g",""!==a.humidity?parseFloat(a.humidity):0,"Humidity",0,100,"%")},makeTempGuage=function(a,b,c,d,e,f){d=d||0,e=e||200,$(a).highcharts({chart:{type:"solidgauge"},credits:{enabled:!1},pane:{center:["50%","85%"],size:"100%",startAngle:-90,endAngle:90,background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}},title:null,tooltip:{enabled:!1},yAxis:{min:d,max:e,stops:[[.3,"#00ccff"],[.5,"#cccc00"],[.7,"#ffcc00"],[.9,"#ff3300"]],lineWidth:0,minorTickInterval:null,tickPositions:[d,e],tickWidth:0,title:{text:c,y:-70},labels:{y:15}},series:[{data:[b],dataLabels:{formatter:function(){return'<div class="temp">'+Highcharts.numberFormat(this.y,0)+f+"</div>"}}}]})},makeGraph=function(a,b){function c(a){for(var c=[],d=b.length-1;d>=0;d--){var e=Date.parse(b[d].timestamp),f=parseFloat(b[d][a]);if(c.push([e,isNaN(f)?null:f]),d>0){var g=Date.parse(b[d-1].timestamp);g-e>102e4&&c.push([Date.parse((e+g)/2),null])}}return c}$(a).highcharts({chart:{borderColor:"#ccc",borderRadius:4,borderWidth:1,type:"line",zoomType:"x"},plotOptions:{line:{marker:{enabled:!1}}},title:null,xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%l:%M:%S %P",minute:"%l:%M %P",hour:"%l:%M %P"}},yAxis:[{min:32,title:{text:"Temperature (°F)"}},{min:0,title:{text:"Humidity (%)"},opposite:!0}],series:[{name:"Temperature",data:c("temperature"),tooltip:{valueSuffix:"°F"}},{name:"Humidity",data:c("humidity"),tooltip:{valueSuffix:"%"},color:"#ebc03f",yAxis:1}]})},updateGraph=function(a,b){function c(a,c){var d=Date.parse(b[c].timestamp),e=parseFloat(b[c][a]);return[d,isNaN(e)?null:e]}for(var d=$(a).highcharts(),e=b.length-1;e>=0;e--)d.series[0].addPoint(c("temperature",e),!0,!0),d.series[1].addPoint(c("humidity",e),!0,!0)},phant,init=function(){$("#settings form input").on("keyup",onSettingsSubmit).on("change",onSettingsSubmit);var a={url:"https://data.sparkfun.com"};if(""!==location.search)for(var b=decodeURIComponent(location.search.substr(1)),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");2===e.length&&(a[e[0]]=e[1])}else $("#tabs a:last").tab("show");$("#phant_url").val(a.url),$("#phant_public_key").val(a.public_key),buildUrl(),phant=new Phant({public_key:a.public_key,url:a.url}),phant.fetch({},onPhantFetch)},onSettingsSubmit=function(a){a.preventDefault(),buildUrl()},onPhantFetch=function(a){if(phant.getStats(onPhantStats),clearAllAlerts(),a.message)showAlert(a.message,{alertClass:"warning",glyphiconClass:"alert"});else{var b=a[0];showStatus(b),makeTempGauges(b),makeGraph("#plot",a),phant.startPolling({},onPhantPolled)}},onPhantRealtime=function(a){console.log(a)},onPhantPolled=function(a){if(clearAllAlerts(),a.message)showAlert(a.message,{alertClass:"warning",glyphiconClass:"alert"});else if(a.length>0){var b=a[0];showStatus(b),makeTempGauges(b),updateGraph("#plot",a)}},onPhantStats=function(a){var b=a.used/a.cap*100;$(".stats").attr("title",b.toFixed(2)+"% space used."),$(".stats .progress-bar").css({width:b.toFixed(2)+"%"}),$(".stats").show()},buildUrl=function(){var a=new Parameters({public_key:$("#phant_public_key").val()});"https://data.sparkfun.com"!==$("#phant_url").val()&&a.set("url",$("#phant_url").val());var b=window.location.href.replace(/\?.*/,"")+"?"+a.serialize();$("#site_url").attr("href",b).text(b)},showAlert=function(a,b){"undefined"==typeof b&&(b={});var c=$("<div/>").addClass("status alert alert-"+(b.alertClass||"info")).appendTo("#alerts");return b.glyphiconClass&&$("<span/>").addClass("glyphicon glyphicon-"+b.glyphiconClass).attr("aria-hidden","true").appendTo(c),$("<span/>").addClass("text").html(a).appendTo(c),c},clearAllAlerts=function(){$("#alerts .alert").remove()},showStatus=function(a){var b=Date.parse(a.timestamp),c=Date.now()-b>9e5?!0:!1;if(clearAllAlerts(),c){var d=new Date(b);showAlert('System appears offline.  Last update at <strong id="last_update_time">'+d.toLocaleString()+"</strong>",{alertClass:"danger",glyphiconClass:"warning-sign"})}};$(document).ready(init);var Parameters=function(a){this.params="object"==typeof a?a:{}};Parameters.prototype.set=function(a,b){this.params[a]=b},Parameters.prototype.serialize=function(){var a=[];for(var b in this.params)this.params.hasOwnProperty(b)&&a.push(encodeURIComponent(b)+"="+encodeURIComponent(this.params[b]));return a.join("&")},Parameters.prototype.formData=function(){var a=new FormData;for(var b in this.params)this.params.hasOwnProperty(b)&&a.append(b,this.params[b]);return a};var Phant=function(a){this.url=a.url,this.public_key=a.public_key,this.private_key=a.private_key};Phant.prototype.fetch=function(a,b){var c=this,d=new Parameters(a),e=new XMLHttpRequest;e.open("GET",this.url+"/output/"+this.public_key+".json?"+d.serialize()),e.responseType="json",e.onload=function(){Array.isArray(this.response)&&this.response.length>0&&(c._current_data_timestamp=this.response[0].timestamp),b(this.response)},e.send()},Phant.prototype.update=function(a,b){var c=new Parameters(a),d=new XMLHttpRequest;d.open("POST",this.url+"/input/"+this.public_key+".json"),d.setRequestHeader("Phant-Private-Key",this.private_key),d.responseType="json",d.onload=function(){b(this.response)},d.send(c.formData())},Phant.prototype.clear=function(a){var b=new XMLHttpRequest;b.open("DELETE",this.url+"/input/"+this.public_key+".json"),b.setRequestHeader("Phant-Private-Key",this.private_key),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.getStats=function(a){var b=new XMLHttpRequest;b.open("GET",this.url+"/output/"+this.public_key+"/stats.json"),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.enableRealtime=function(a){var b=this,c=document.createElement("script");c.setAttribute("src",this.url+"/js/phant-manager.min.js"),c.async=!0,c.onload=function(){"undefined"!=typeof mows&&(this._client=mows.createClient(b.url.replace(/^http/,"ws")),this._client.subscribe("output/"+b.public_key),this._client.on("message",function(b,c){a(JSON.parse(c))}))},document.body.appendChild(c)},Phant.prototype.startPolling=function(a,b,c){var d=this;this._poll_timeout=window.setTimeout(function(){if(d._current_data_timestamp){var e=a||{};e["gt[timestamp]"]=d._current_data_timestamp,d.fetch(e,function(e){d.startPolling(a,b,c),b(e)})}else d.startPolling(a,b,c)},c||6e4)},Phant.prototype.stopPolling=function(){window.clearTimeout(this._poll_timeout)};
//# sourceMappingURL=main.min.js.map